<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ATJ COMP SEASON 2026</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fff;--text:#111827;--muted:#6b7280;--line:#e5e7eb;
      --row-alt:#fafafa;--chip-bg:#f3f4f6;--chip-on:#111827;
      --chip-active-bg:#111827;--chip-active:#fff;
      --card-bg:#fff;

      /* badges */
      --badge-orange-bg:#fff7ed;--badge-orange:#c2410c; /* Showcase */
      --badge-purple-bg:#f5f3ff;--badge-purple:#5b21b6; /* Origin */
      --badge-green-bg:#ecfdf5;--badge-green:#065f46;   /* Evolution */
      --badge-teal-bg:#f0fdfa;--badge-teal:#0f766e;     /* Get The Beat */
      --badge-blue-bg:#eff6ff;--badge-blue:#1e40af;     /* Fallback */

      --fs-th:12px;
      --fs-td:11px;
      --fs-label:11px;
    }

    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .container{max-width:100%;margin:28px auto;padding:0 16px}

    /* Header */
    h1{font-size:32px;font-weight:800;margin:0}
    .underline-title{font-size:18px;font-weight:700;margin:6px 0 18px}
    .underline-title::after{content:"";display:block;height:3px;margin-top:6px;background:#111827;width:260px;border-radius:2px}

    /* Cards */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:18px}
    .card{border:1px solid var(--line);border-radius:14px;padding:16px;background:var(--card-bg)}
    .card h3{margin:0 0 8px;font-size:18px}
    .muted{color:var(--muted);font-size:14px;line-height:1.45}
    .muted div{margin:4px 0}

    /* Search + chips */
    .controls{display:flex;justify-content:center;margin:12px 0}
    .search{width:100%;max-width:720px;padding:12px;border-radius:12px;border:1px solid var(--line);font-size:16px}
    .chips{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:10px 0 14px}
    .chip{display:inline-flex;align-items:center;gap:.4rem;border:1px solid var(--line);background:var(--chip-bg);color:var(--chip-on);
      border-radius:12px;padding:10px 14px;font-size:14px;font-weight:600;cursor:pointer;user-select:none}
    .chip.active{background:var(--chip-active-bg);color:var(--chip-active);border-color:var(--chip-active-bg)}

    /* Table */
    .table-wrap{display:block}
    table{width:100%;border-collapse:collapse;margin-top:6px}
    thead th{
      font-size:var(--fs-th);text-align:left;padding:10px;border-bottom:1px solid var(--line);
      position:sticky;top:0;background:#f8f8f8;z-index:1;
    }
    tbody td{font-size:var(--fs-td);padding:10px;border-bottom:1px solid var(--line);vertical-align:top;line-height:1.35}
    tbody tr:nth-child(even){background:var(--row-alt)}

    /* Badges */
    .badge{display:inline-flex;align-items:center;padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px;line-height:1;white-space:nowrap}
    .badge.orange{background:var(--badge-orange-bg);color:var(--badge-orange)}
    .badge.purple{background:var(--badge-purple-bg);color:var(--badge-purple)}
    .badge.green{background:var(--badge-green-bg);color:var(--badge-green)}
    .badge.teal{background:var(--badge-teal-bg);color:var(--badge-teal)}
    .badge.blue{background:var(--badge-blue-bg);color:var(--badge-blue)}

    /* Mobile cards */
    #cards{display:none;margin-top:12px}
    .row-card{border:1px solid var(--line);border-radius:14px;background:var(--card-bg);padding:12px}
    .row-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .row-title{font-weight:800;font-size:14px}
    .row-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .item{font-size:13px}
    .label{font-size:var(--fs-label);color:var(--muted);display:block;margin-bottom:2px}
    .remark{margin-top:10px}

    mark{background:#fff3bf;padding:0 .15em;border-radius:.2em}

    @media (max-width:900px){
      h1{font-size:22px}
      .underline-title{font-size:13px}
      .grid{grid-template-columns:1fr}
      .table-wrap{display:none}
      #cards{display:grid;gap:12px}
      .row-grid{grid-template-columns:1fr}
    }

    @media print{
      .controls,.grid,#cards,.chips{display:none}
      .container{margin:0;padding:0}
      thead th,tbody td{font-size:12px;padding:8px}
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ATJ COMP SEASON 2026</h1>
    <div class="underline-title">SHOWCASE &amp; COMPETITION SCHEDULE</div>

    <div class="grid" aria-label="Key info">
      <div class="card">
        <h3>Key Dates</h3>
        <div class="muted">
          <div><strong>Comp Team Showcase:</strong> 18th &amp; 19th April</div>
          <div><strong>Origin Dance Convention:</strong> 1st – 3rd May</div>
          <div><strong>Evolution Dance Competition:</strong> 28th May – 5th June</div>
          <div><strong>Get The Beat Asia:</strong> 30th May – 7th June</div>
        </div>
      </div>

      <div class="card">
        <h3>Venues</h3>
        <div class="muted">
          <div><strong>Comp Team Showcase:</strong> All That Jazz Dance Academy, 36 Prinsep St, #04-01, Singapore 188648</div>
          <div><strong>Origin Dance Convention:</strong> Gateway Theatre Complex, 615 Jalan Bukit Merah, Singapore 159461</div>
          <div><strong>Evolution Dance Competition:</strong> Kreta Ayer Community Club, 28 Kreta Ayer Rd, Singapore 088995</div>
          <div><strong>Get The Beat Asia:</strong> Gateway Theatre Complex, 615 Jalan Bukit Merah, Singapore 159461</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <input id="search" class="search" placeholder="Search by student's full name" aria-label="Search by student's full name"/>
    </div>

    <div class="chips" role="tablist" aria-label="Quick filters">
      <div class="chip active" data-filter="all" role="tab" aria-selected="true">⭐ All</div>
      <div class="chip" data-filter="showcase" role="tab" aria-selected="false">Showcase</div>
      <div class="chip" data-filter="origin" role="tab" aria-selected="false">Origin</div>
      <div class="chip" data-filter="evolution" role="tab" aria-selected="false">Evolution</div>
      <div class="chip" data-filter="gtb" role="tab" aria-selected="false">Get The Beat</div>
    </div>

    <div class="table-wrap" aria-live="polite">
      <table>
        <thead>
          <tr>
            <th>Event Type</th>
            <th>Day &amp; Date</th>
            <th>Student Name</th>
            <th>Category</th>
            <th>Item</th>
            <th>Venue</th>
            <th>Reporting</th>
            <th>Event</th>
            <th>Dismissal</th>
            <th>Full Look</th>
            <th>Remarks</th>
            <th>Results</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div id="cards" aria-live="polite"></div>
  </div>

  <script>
    // Pull JSON from your Flask endpoint (/data)
    const BASE = "/data";

    const COLS = ["Day & Date","Student Name","Event Type","Category","Item","Venue","Reporting Time","Event Time","Dismissal Time","Full Look","Remarks","Results"];

    const tbody = document.getElementById("tbody");
    const cards = document.getElementById("cards");
    const searchEl = document.getElementById("search");
    const chips = [...document.querySelectorAll(".chip")];

    let RAW = [];
    let FILTER = "all";
    let QUERY = "";

    const esc = (s) => String(s ?? "").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
    }[m]));

    function hi(text, q){
      const s = esc(String(text ?? ""));
      if(!q) return s;
      const safe = q.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");
      return s.replace(new RegExp(`(${safe})`,"ig"), "<mark>$1</mark>");
    }

    function badge(eventType){
      const t = String(eventType ?? "").toLowerCase();
      if(t.includes("showcase")) return '<span class="badge orange">Showcase</span>';
      if(t.includes("origin")) return '<span class="badge purple">Origin</span>';
      if(t.includes("evolution")) return '<span class="badge green">Evolution</span>';
      if(t.includes("get the beat") || t.includes("gtb") || t.includes("get")) return '<span class="badge teal">Get The Beat</span>';
      return '<span class="badge blue">' + esc(eventType) + '</span>';
    }

    function passFilter(r){
      const t = String(r["Event Type"] ?? "").toLowerCase();
      if(FILTER === "showcase") return t.includes("showcase");
      if(FILTER === "origin") return t.includes("origin");
      if(FILTER === "evolution") return t.includes("evolution");
      if(FILTER === "gtb") return t.includes("get the beat") || t.includes("gtb") || t.includes("get");
      return true;
    }

    function matchQuery(r){
      if(!QUERY) return true;
      const s = QUERY.toLowerCase();
      // Search across ALL columns
      return COLS.some(k => String(r[k] ?? "").toLowerCase().includes(s));
    }

    // Sorting: Day & Date -> Reporting Time -> Student Name
    const DEFAULT_YEAR = 2026;

    function parseDateToTS(str){
      if(!str) return Number.MAX_SAFE_INTEGER;
      let s = String(str).trim();
      s = s.replace(/\b(\d+)(st|nd|rd|th)\b/gi,'$1'); // drop ordinals
      const hasYear = /\b20\d{2}\b/.test(s);
      let ts = Date.parse(s);
      if(isNaN(ts)) ts = Date.parse(s + (hasYear ? '' : `, ${DEFAULT_YEAR}`));
      return isNaN(ts) ? Number.MAX_SAFE_INTEGER : ts;
    }

    function parseTimeToMinutes(str){
      if(!str) return Number.MAX_SAFE_INTEGER;
      const m = String(str).trim().match(/(\d{1,2}):(\d{2})\s*([AP]M)?/i);
      if(!m) return Number.MAX_SAFE_INTEGER;
      let hh = parseInt(m[1],10);
      const mm = parseInt(m[2],10);
      const ampm = m[3] ? m[3].toUpperCase() : null;
      if(ampm){
        if(ampm === "PM" && hh < 12) hh += 12;
        if(ampm === "AM" && hh === 12) hh = 0;
      }
      return hh*60 + mm;
    }

    function sortRows(rows){
      return rows.slice().sort((a,b)=>{
        const dA = parseDateToTS(a["Day & Date"]);
        const dB = parseDateToTS(b["Day & Date"]);
        if(dA !== dB) return dA - dB;

        const tA = parseTimeToMinutes(a["Reporting Time"]);
        const tB = parseTimeToMinutes(b["Reporting Time"]);
        if(tA !== tB) return tA - tB;

        return String(a["Student Name"] ?? "").localeCompare(String(b["Student Name"] ?? ""));
      });
    }

    function renderTable(rows){
      tbody.innerHTML = rows.length ? rows.map(r => `
        <tr>
          <td>${badge(r["Event Type"])}</td>
          <td><strong>${hi(r["Day & Date"], QUERY)}</strong></td>
          <td><strong>${hi(r["Student Name"], QUERY)}</strong></td>
          <td>${hi(r["Category"], QUERY)}</td>
          <td>${hi(r["Item"], QUERY)}</td>
          <td><strong>${hi(r["Venue"], QUERY)}</strong></td>
          <td>${hi(r["Reporting Time"], QUERY)}</td>
          <td>${hi(r["Event Time"], QUERY)}</td>
          <td>${hi(r["Dismissal Time"], QUERY)}</td>
          <td>${hi(r["Full Look"], QUERY)}</td>
          <td>${hi(r["Remarks"], QUERY)}</td>
          <td>${hi(r["Results"], QUERY)}</td>
        </tr>
      `).join("") : `<tr><td colspan="12" style="padding:12px;color:var(--muted);">No results</td></tr>`;
    }

    function renderCards(rows){
      cards.innerHTML = rows.length ? rows.map(r => `
        <div class="row-card">
          <div class="row-head">
            <div class="row-title">${hi(r["Student Name"], QUERY)}</div>
            <div>${badge(r["Event Type"])}</div>
          </div>

          <div class="row-grid">
            <div class="item"><span class="label">Day &amp; Date</span><strong>${hi(r["Day & Date"], QUERY)}</strong></div>
            <div class="item"><span class="label">Category</span>${hi(r["Category"], QUERY)}</div>
            <div class="item"><span class="label">Item</span>${hi(r["Item"], QUERY)}</div>
            <div class="item"><span class="label">Venue</span><strong>${hi(r["Venue"], QUERY)}</strong></div>
            <div class="item"><span class="label">Reporting</span>${hi(r["Reporting Time"], QUERY)}</div>
            <div class="item"><span class="label">Event</span>${hi(r["Event Time"], QUERY)}</div>
            <div class="item"><span class="label">Dismissal</span>${hi(r["Dismissal Time"], QUERY)}</div>
            <div class="item"><span class="label">Full Look</span>${hi(r["Full Look"], QUERY)}</div>
            <div class="item"><span class="label">Results</span>${hi(r["Results"], QUERY)}</div>
          </div>

          ${(r["Remarks"] ?? "").trim() ? `
            <div class="remark">
              <span class="label">Remarks</span>${hi(r["Remarks"], QUERY)}
            </div>` : ""}
        </div>
      `).join("") : `<div style="color:var(--muted);padding:8px 2px;">No results</div>`;
    }

    function render(){
      const filtered = RAW.filter(r => passFilter(r) && matchQuery(r));
      const rows = sortRows(filtered);
      renderTable(rows);
      renderCards(rows);
    }

    async function load(){
      const res = await fetch(`${BASE}?cachebust=${Date.now()}`, { cache: "no-store" });
      if(!res.ok){
        tbody.innerHTML = `<tr><td colspan="12" style="padding:12px;color:var(--muted);">Failed to load data</td></tr>`;
        return;
      }
      RAW = await res.json();
      // ensure consistent keys exist
      RAW = RAW.map(o => {
        const x = {};
        COLS.forEach(k => x[k] = o[k] ?? "");
        return x;
      });
      render();
    }

    searchEl.addEventListener("input", e => {
      QUERY = e.target.value.trim();
      render();
    });

    chips.forEach(ch => ch.addEventListener("click", () => {
      chips.forEach(c => {
        c.classList.remove("active");
        c.setAttribute("aria-selected","false");
      });
      ch.classList.add("active");
      ch.setAttribute("aria-selected","true");
      FILTER = ch.dataset.filter;
      render();
    }));

    load();
  </script>
</body>
</html>
